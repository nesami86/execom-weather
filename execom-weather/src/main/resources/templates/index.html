<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
    xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3">
<head>

<title>Execom weather</title>

<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
<script type="text/javascript">
    //<![CDATA[
    function getWeatherReport() {

        $.get("/weather/report?city=" + $("#city").val(), {}, function(a) {
            alert(a);
        }).fail(function() {
            alert("Fail!");
        });
    }
    
    function displayResults(a) {
    	for (var i = 0; i < a.length; i++) {
    		var date = new Date(a[i].date).toString().substring(0,21);
    		var temperature = Math.round(a[i].temperature);   		
    		fillWeatherTable(date, temperature);
    	}
    	$("#weatherReportTable").show();
    }
    
    function fillWeatherTable(date, temperature) {
    	if(date.indexOf("00:00") > -1)
            $("#weatherReportTable table").append("<tr class='content'><td> &nbsp; </td></tr>");
    	
    	var content = "<tr class='content'><td>" + date + "</td><td align='center'>" + temperature + "</td></tr>";
    	$("#weatherReportTable table").append(content);
    	
    	if(date.indexOf("23:00") > -1)
    		$("#weatherReportTable table").append("<tr class='content'><td> &nbsp; </td></tr>");	 
    }

    function getWeatherHistory() {

        var weatherPeriod = { cityId : $("#city2").val(), startingDate : $("#date1").val(), endingDate : $("#date2").val() };

        $.ajax({

            type : "POST",
            contentType : "application/json; charset=utf-8",
            url : "/weather/getPeriod",
            data : JSON.stringify(weatherPeriod),
            dataType : "JSON"

        }).done(function(a) {
        	displayResults(a);
        }).fail(function() {
            alert("Fail!");
        });
    }

    $(document).ready(function() {

        $("#getWeather").click(function() {
            getWeatherReport();
        });

        $("#getWeatherHistory").click(function() {
            getWeatherHistory();
        });
        
        $("#clear").click(function(){
        	$("tr.content").remove();
        });
    });
    //]]>
</script>
</head>
<body>
    <h3>Welcome to Execom Weather application</h3>

    <br />

    <form action="/adminPage" method="POST">
        <button type="submit">Admin Log In</button>
    </form>

    <br />

    <div>
        <input type="text" id="city" placeHolder="Enter city name ... " />
        <button id="getWeather">Get weather report</button>
    </div>

    <br />

    <div>
        <p>
            Get weather report for <select id="city2">
            <option th:each="city:${ cities }" th:value="${ city.id }" th:text="${ city.id }"></option>
                </select> from <input type="date" id="date1" /> to <input type="date" id="date2" />

            <button id="getWeatherHistory">Get report</button>
        </p>
    </div>
    
    <div id="weatherReportTable" style="display: none; z-index: 2;">
        <table>
            <tr><td align="center"><b>Time:</b></td><td align="center"><b>Temperature:</b></td></tr>
        </table>
    </div>
    
    <button id="clear">Clear</button>

</body>
</html>